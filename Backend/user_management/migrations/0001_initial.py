# Generated by Django 5.2.3 on 2026-01-22 14:54

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ClientProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('client_id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Unique business identifier for Service Operations', unique=True)),
                ('client_type', models.CharField(choices=[('residential', 'Residential'), ('business', 'Business')], default='residential', max_length=20)),
                ('tier', models.CharField(choices=[('new', 'New Client'), ('bronze', 'Bronze'), ('silver', 'Silver'), ('gold', 'Gold'), ('platinum', 'Platinum'), ('diamond', 'Diamond'), ('vip', 'VIP')], default='new', max_length=20)),
                ('status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive'), ('suspended', 'Suspended'), ('trial', 'Trial'), ('at_risk', 'At Risk'), ('churned', 'Churned')], default='active', max_length=20)),
                ('referral_code', models.CharField(blank=True, db_index=True, help_text='Unique referral code', max_length=12, unique=True)),
                ('is_marketer', models.BooleanField(default=False)),
                ('marketer_tier', models.CharField(choices=[('novice', 'Novice'), ('intermediate', 'Intermediate'), ('expert', 'Expert'), ('master', 'Master')], default='novice', max_length=20)),
                ('lifetime_value', models.DecimalField(decimal_places=2, default=0.0, max_digits=12, validators=[django.core.validators.MinValueValidator(0)])),
                ('monthly_recurring_revenue', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('total_revenue', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('avg_monthly_spend', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('commission_balance', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('total_commission_earned', models.DecimalField(decimal_places=2, default=0.0, max_digits=12)),
                ('commission_rate', models.DecimalField(decimal_places=2, default=10.0, max_digits=5)),
                ('total_data_used_gb', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('avg_monthly_data_gb', models.DecimalField(decimal_places=2, default=0.0, max_digits=8)),
                ('peak_usage_hour', models.IntegerField(blank=True, help_text='Hour (0-23) of peak usage', null=True)),
                ('churn_risk_score', models.DecimalField(decimal_places=2, default=0.0, max_digits=4, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(10)])),
                ('engagement_score', models.DecimalField(decimal_places=2, default=5.0, max_digits=4, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(10)])),
                ('satisfaction_score', models.DecimalField(decimal_places=2, default=0.0, max_digits=4, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(10)])),
                ('hotspot_sessions', models.IntegerField(default=0)),
                ('hotspot_conversion_rate', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('payment_abandonment_rate', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('days_active', models.IntegerField(default=0)),
                ('renewal_rate', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('days_since_last_payment', models.IntegerField(default=0)),
                ('primary_device', models.CharField(choices=[('android', 'Android'), ('ios', 'iOS'), ('windows', 'Windows'), ('mac', 'Mac'), ('linux', 'Linux'), ('other', 'Other')], default='android', max_length=20)),
                ('devices_count', models.IntegerField(default=1)),
                ('location', models.JSONField(default=dict, help_text='Location data')),
                ('preferred_payment_method', models.CharField(choices=[('mpesa', 'M-Pesa'), ('paypal', 'PayPal'), ('bank', 'Bank Transfer')], default='mpesa', max_length=20)),
                ('notification_preferences', models.JSONField(default=dict, help_text='Notification settings')),
                ('communication_preferences', models.JSONField(default=dict, help_text='Preferred communication channels')),
                ('router_id', models.CharField(blank=True, help_text='Router ID for PPPoE clients (from Service Operations)', max_length=100)),
                ('hotspot_mac_address', models.CharField(blank=True, help_text='MAC address for hotspot clients', max_length=100)),
                ('behavior_tags', models.JSONField(default=list, help_text='Automated behavior classification tags')),
                ('revenue_segment', models.CharField(choices=[('low', 'Low Value'), ('medium', 'Medium Value'), ('high', 'High Value'), ('premium', 'Premium')], default='low', max_length=20)),
                ('usage_pattern', models.CharField(choices=[('casual', 'Casual'), ('regular', 'Regular'), ('heavy', 'Heavy'), ('extreme', 'Extreme')], default='casual', max_length=20)),
                ('insights', models.JSONField(default=list, help_text='Automated insights about client behavior')),
                ('recommendations', models.JSONField(default=list, help_text='Recommended actions for this client')),
                ('next_best_offer', models.JSONField(default=dict, help_text='Recommended next offer for this client')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('flags', models.JSONField(default=list, help_text='System flags and alerts')),
                ('customer_since', models.DateTimeField(default=django.utils.timezone.now)),
                ('last_payment_date', models.DateTimeField(blank=True, null=True)),
                ('last_usage_date', models.DateTimeField(blank=True, null=True)),
                ('last_login_date', models.DateTimeField(blank=True, null=True)),
                ('next_payment_due', models.DateTimeField(blank=True, null=True)),
                ('tier_upgraded_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('referred_by', models.ForeignKey(blank=True, help_text='Client who referred this client', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referrals', to='user_management.clientprofile')),
                ('user', models.OneToOneField(help_text='Linked user from authentication system', on_delete=django.db.models.deletion.CASCADE, related_name='business_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Client Business Profile',
                'verbose_name_plural': 'Client Business Profiles',
            },
        ),
        migrations.CreateModel(
            name='ClientInteraction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('interaction_type', models.CharField(choices=[('payment_success', 'Payment Successful'), ('payment_failed', 'Payment Failed'), ('payment_pending', 'Payment Pending'), ('payment_abandoned', 'Payment Abandoned'), ('data_usage', 'Data Usage'), ('session_start', 'Session Started'), ('session_end', 'Session Ended'), ('support_ticket', 'Support Ticket'), ('support_resolved', 'Support Resolved'), ('email_sent', 'Email Sent'), ('sms_sent', 'SMS Sent'), ('notification', 'Notification'), ('login', 'Login'), ('logout', 'Logout'), ('profile_update', 'Profile Updated'), ('hotspot_connect', 'Hotspot Connected'), ('hotspot_auth', 'Hotspot Authentication'), ('hotspot_payment_page', 'Hotspot Payment Page'), ('hotspot_plan_selection', 'Hotspot Plan Selection')], max_length=30)),
                ('action', models.CharField(max_length=100)),
                ('description', models.TextField()),
                ('outcome', models.CharField(choices=[('success', 'Success'), ('failure', 'Failure'), ('pending', 'Pending'), ('cancelled', 'Cancelled'), ('abandoned', 'Abandoned'), ('timeout', 'Timeout')], default='pending', max_length=20)),
                ('is_hotspot', models.BooleanField(default=False)),
                ('hotspot_session_id', models.CharField(blank=True, max_length=100)),
                ('hotspot_plan_selected', models.CharField(blank=True, max_length=50)),
                ('payment_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('payment_method', models.CharField(blank=True, max_length=20)),
                ('payment_reference', models.CharField(blank=True, max_length=100)),
                ('data_used_bytes', models.BigIntegerField(default=0)),
                ('session_duration_seconds', models.IntegerField(default=0)),
                ('device_type', models.CharField(blank=True, max_length=20)),
                ('user_agent', models.TextField(blank=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('started_at', models.DateTimeField()),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('duration_seconds', models.IntegerField(default=0)),
                ('flow_stage', models.CharField(blank=True, max_length=50)),
                ('next_stage', models.CharField(blank=True, max_length=50)),
                ('flow_abandoned_at', models.CharField(blank=True, max_length=50)),
                ('error_code', models.CharField(blank=True, max_length=50)),
                ('error_message', models.TextField(blank=True)),
                ('error_details', models.JSONField(default=dict)),
                ('converted_to_purchase', models.BooleanField(default=False)),
                ('purchase_reference', models.CharField(blank=True, max_length=100)),
                ('metadata', models.JSONField(default=dict)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='interactions', to='user_management.clientprofile')),
            ],
            options={
                'verbose_name': 'Client Interaction',
                'verbose_name_plural': 'Client Interactions',
            },
        ),
        migrations.CreateModel(
            name='ClientAnalyticsSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateField(db_index=True)),
                ('daily_revenue', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('monthly_revenue_ytd', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('revenue_growth_rate', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('daily_data_gb', models.DecimalField(decimal_places=2, default=0.0, max_digits=8)),
                ('session_count', models.IntegerField(default=0)),
                ('avg_session_duration_minutes', models.DecimalField(decimal_places=2, default=0.0, max_digits=6)),
                ('peak_usage_hour', models.IntegerField(blank=True, null=True)),
                ('churn_risk_score', models.DecimalField(decimal_places=2, default=0.0, max_digits=4)),
                ('engagement_score', models.DecimalField(decimal_places=2, default=5.0, max_digits=4)),
                ('hotspot_sessions', models.IntegerField(default=0)),
                ('hotspot_conversions', models.IntegerField(default=0)),
                ('payment_attempts', models.IntegerField(default=0)),
                ('payment_abandonments', models.IntegerField(default=0)),
                ('top_categories', models.JSONField(default=list)),
                ('top_domains', models.JSONField(default=list)),
                ('device_distribution', models.JSONField(default=dict)),
                ('percentile_rank', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('segment_average', models.JSONField(default=dict)),
                ('predicted_next_payment', models.DateField(blank=True, null=True)),
                ('predicted_churn_date', models.DateField(blank=True, null=True)),
                ('predicted_ltv', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='analytics_snapshots', to='user_management.clientprofile')),
            ],
            options={
                'verbose_name': 'Client Analytics Snapshot',
                'verbose_name_plural': 'Client Analytics Snapshots',
            },
        ),
        migrations.CreateModel(
            name='CommissionTransaction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('transaction_type', models.CharField(choices=[('referral', 'Referral Commission'), ('bonus', 'Performance Bonus'), ('payout', 'Commission Payout'), ('adjustment', 'Adjustment'), ('promotional', 'Promotional Commission')], default='referral', max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=10)),
                ('description', models.TextField()),
                ('reference_id', models.CharField(db_index=True, max_length=100)),
                ('purchase_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('commission_rate', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('tier_bonus', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('total_commission', models.DecimalField(decimal_places=2, default=0.0, max_digits=10)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('paid', 'Paid'), ('rejected', 'Rejected'), ('cancelled', 'Cancelled'), ('hold', 'On Hold')], default='pending', max_length=20)),
                ('notes', models.JSONField(default=list)),
                ('payment_method', models.CharField(blank=True, max_length=20)),
                ('payment_reference', models.CharField(blank=True, max_length=100)),
                ('transaction_date', models.DateTimeField(db_index=True, default=django.utils.timezone.now)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('paid_at', models.DateTimeField(blank=True, null=True)),
                ('due_date', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_commissions', to=settings.AUTH_USER_MODEL)),
                ('marketer', models.ForeignKey(limit_choices_to={'is_marketer': True}, on_delete=django.db.models.deletion.CASCADE, related_name='commission_transactions', to='user_management.clientprofile')),
                ('referred_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referred_transactions', to='user_management.clientprofile')),
            ],
            options={
                'verbose_name': 'Commission Transaction',
                'verbose_name_plural': 'Commission Transactions',
                'ordering': ['-transaction_date'],
            },
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['client_id'], name='user_manage_client__64d4e9_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['referral_code'], name='user_manage_referra_bdfa90_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['status', 'tier'], name='user_manage_status_65b2b6_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['client_type'], name='user_manage_client__81593c_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['churn_risk_score'], name='user_manage_churn_r_a31930_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['lifetime_value'], name='user_manage_lifetim_747166_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['revenue_segment'], name='user_manage_revenue_b2dc0b_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['created_at', 'updated_at'], name='user_manage_created_00939a_idx'),
        ),
        migrations.AddIndex(
            model_name='clientprofile',
            index=models.Index(fields=['days_since_last_payment'], name='user_manage_days_si_9918bf_idx'),
        ),
        migrations.AddIndex(
            model_name='clientinteraction',
            index=models.Index(fields=['client', 'started_at'], name='user_manage_client__6dd5c7_idx'),
        ),
        migrations.AddIndex(
            model_name='clientinteraction',
            index=models.Index(fields=['interaction_type', 'outcome'], name='user_manage_interac_3bbae7_idx'),
        ),
        migrations.AddIndex(
            model_name='clientinteraction',
            index=models.Index(fields=['is_hotspot', 'outcome'], name='user_manage_is_hots_3f6294_idx'),
        ),
        migrations.AddIndex(
            model_name='clientinteraction',
            index=models.Index(fields=['converted_to_purchase'], name='user_manage_convert_55ea5a_idx'),
        ),
        migrations.AddIndex(
            model_name='clientinteraction',
            index=models.Index(fields=['flow_stage', 'flow_abandoned_at'], name='user_manage_flow_st_a93646_idx'),
        ),
        migrations.AddIndex(
            model_name='clientanalyticssnapshot',
            index=models.Index(fields=['date', 'churn_risk_score'], name='user_manage_date_869764_idx'),
        ),
        migrations.AddIndex(
            model_name='clientanalyticssnapshot',
            index=models.Index(fields=['client', 'date'], name='user_manage_client__874f83_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='clientanalyticssnapshot',
            unique_together={('client', 'date')},
        ),
        migrations.AddIndex(
            model_name='commissiontransaction',
            index=models.Index(fields=['marketer', 'transaction_date'], name='user_manage_markete_951dea_idx'),
        ),
        migrations.AddIndex(
            model_name='commissiontransaction',
            index=models.Index(fields=['status', 'transaction_type'], name='user_manage_status_da412c_idx'),
        ),
        migrations.AddIndex(
            model_name='commissiontransaction',
            index=models.Index(fields=['reference_id'], name='user_manage_referen_ba7f55_idx'),
        ),
        migrations.AddIndex(
            model_name='commissiontransaction',
            index=models.Index(fields=['due_date', 'status'], name='user_manage_due_dat_8dcb63_idx'),
        ),
    ]
